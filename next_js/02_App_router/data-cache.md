# ë°ì´í„° ìºì‹œ(Data Cache)

- fetch ë©”ì„œë“œë¥¼ í™œìš©í•´ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¥¼ Next ì„œë²„ì—ì„œ ë³´ê´€í•˜ëŠ” ê¸°ëŠ¥
- ì˜êµ¬ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ê´€í•˜ê±°ë‚˜, íŠ¹ì • ì‹œê°„ì„ ì£¼ê¸°ë¡œ ê°±ì‹  ì‹œí‚¤ëŠ” ê²ƒë„ ê°€ëŠ¥
- ë¶ˆí•„ìš”í•œ ë°ì´í„° ìš”ì²­ ìˆ˜ë¥¼ ì¤„ì—¬ì„œ ì›¹ ì„œë¹„ìŠ¤ì˜ ì„±ëŠ¥ ê°œì„  ê°€ëŠ¥

## 1. ðŸŽ¯ í•µì‹¬ ê°œë… & ëª©ì 

- **ëª©í‘œ**

  - **ì¤‘ë³µ ë°ì´í„° ìš”ì²­ ë°©ì§€, ì„±ëŠ¥ í–¥ìƒ, ì„œë²„ ë¶€í•˜ ê°ì†Œ**ë¥¼ ìœ„í•´ ë„ìž…ë¨.
  - ê°™ì€ ë°ì´í„°ì— ëŒ€í•œ ìš”ì²­ì´ ì—¬ëŸ¬ ë²ˆ ë°œìƒí•˜ê±°ë‚˜ ë°˜ë³µì ìœ¼ë¡œ API í˜¸ì¶œì´ í•„ìš”í•  ë•Œ, **cacheëœ ë°ì´í„°ë¥¼ ìž¬ì‚¬ìš©**í•¨ìœ¼ë¡œì¨ íš¨ìœ¨ì„ ê·¹ëŒ€í™”

- **ê°œì„ í•˜ë ¤ëŠ” ë¬¸ì œì **

  - ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ URLì„ `fetch`í•˜ë©´ ë§¤ë²ˆ ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œì´ ë°œìƒí•¨.
  - `Server Component`ì—ì„œ `fetch`, DB ì¿¼ë¦¬ ë“±ì„ ìºì‹±í•˜ì§€ ì•Šìœ¼ë©´ ë¶ˆí•„ìš”í•œ I/O, ëŠë¦° ë Œë”ë§ â€¦ ë“± ë¬¸ì œ ë°œìƒ.

## 2. ðŸ›  Next.js ë°ì´í„° ìºì‹œ ì‚¬ìš©ë²•

### 2â€‘1. `fetch` ìºì‹± ì˜µì…˜ - ì˜¤ì§ fetch ë©”ì„œë“œì—ì„œë§Œ í™œìš© ê°€ëŠ¥

#### `cache: 'no-store` : default ì˜µì…˜

```ts
fetch('https://api...', { cache: 'no-store' });
```

- ë°ì´í„° íŽ˜ì¹­ì˜ ê²°ê³¼ë¥¼ ì €ìž¥í•˜ì§€ ì•ŠëŠ” ì˜µì…˜
- ìš”ì²­ë§ˆë‹¤ í•­ìƒ ë„¤íŠ¸ì›Œí¬ì—ì„œ ìµœì‹  ë°ì´í„° fetch.

#### `cache: 'force-cache`

```ts
fetch('https://api...', { cache: 'force-cache' });
```

- ìš”ì²­ì˜ ê²°ê³¼ë¥¼ ë¬´ì¡°ê±´ ìºì‹±í•¨
- í•œë²ˆ í˜¸ì¶œ ëœ ì´í›„ì—ëŠ” ë‹¤ì‹œ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ

#### `cache: 'reload`

```ts
// ë„¤íŠ¸ì›Œí¬ ìš”ì²­ í›„ ìºì‹œ ì—…ë°ì´íŠ¸
fetch('https://api...', { cache: 'reload' });
```

- í•­ìƒ ë„¤íŠ¸ì›Œí¬ì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ ìºì‹œë¥¼ ì—…ë°ì´íŠ¸ (ì§€ì›)
- `force-cache`ì™€ default ì˜µì…˜(`no-store`) ìœ„ì£¼ë¡œ ì‚¬ìš©

#### âœ… `next.revalidate` : ì‹œê°„ ê¸°ë°˜ ìž¬ê²€ì¦

```ts
fetch('https://api...', { next: { revalidate: 600 } }); // 10ë¶„ë§ˆë‹¤ ìž¬ê²€ì¦
```

- `number`: (ì´ˆ ë‹¨ìœ„ TTL) íŠ¹ì • ì‹œê°„ì´ ì§€ë‚œ í›„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìžë™ revalidation.
- `0`: ìºì‹œ í•˜ì§€ ì•Šê³ , SSRì²˜ëŸ¼ ë§¤ ìš”ì²­ë§ˆë‹¤ fetch.
- `false`: ìºì‹œ ë¬´ê¸°í•œ ìœ ì§€

#### âœ… íƒœê·¸ ê¸°ë°˜ ë¬´íš¨í™”

```ts
fetch('https://api...', { next: { tags: ['user', 'posts'] } });
revalidateTag('posts'); // ê´€ë ¨ cache í•œ ë²ˆì— ë¬´íš¨í™”
```

- ìºì‹œ í•­ëª©ì— íƒœê·¸ ì§€ì • â†’ revalidateTag()ë¡œ ê·¸ë£¹ ë¬´íš¨í™” ê°€ëŠ¥.

#### âœ… ê²½ë¡œ ê¸°ë°˜ ë¬´íš¨í™”

```ts
revalidatePath('/dashboard/post/123');
```

- ê²½ë¡œ ë‹¨ìœ„ ìºì‹œ ë¬´íš¨í™” (Full Route Cache í¬í•¨)

---

## 3. ðŸ§© ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì„±ëŠ¥ ë¹„êµ

| í•­ëª©                  | Next.js `fetch` ìºì‹œ        | `unstable_cache`                      | React Query / SWR ë“± ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬   |
| --------------------- | --------------------------- | ------------------------------------- | -------------------------------------- |
| **ìŠ¤ì½”í”„**            | fetch ë‹¨ìœ„ ìºì‹œ             | í•¨ìˆ˜ í˜¸ì¶œ ë‹¨ìœ„ ì „ì—­ ìºì‹œ              | ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ í´ë¼ì´ì–¸íŠ¸ ìºì‹œ          |
| **ê°±ì‹  ë°©ì‹**         | ì‹œê°„ ê¸°ë°˜ (`revalidate`)    | ì‹œê°„ ê¸°ë°˜ + íƒœê·¸ ì´ë²¤íŠ¸ ê¸°ë°˜          | `staleTime`, `cacheTime`, ìˆ˜ë™ ê°±ì‹  ë“± |
| **êµ¬í˜„ ë³µìž¡ë„**       | ê°„ë‹¨: ì˜µì…˜ìœ¼ë¡œ ì œì–´         | ì•½ê°„ ë³µìž¡: íƒœê·¸/í‚¤ ì„¤ì • í•„ìš”          | ìƒëŒ€ì ìœ¼ë¡œ ì½”ë“œ ë³µìž¡ (ì¿¼ë¦¬ ê´€ë¦¬ ë“±)    |
| **ì„œë²„ ì„±ëŠ¥ ìµœì í™”**  | JSON fetch ì¤‘ë³µ ì œê±°        | DB ì¿¼ë¦¬ ë“± ì¶”ìƒ í•¨ìˆ˜ ìºì‹œ ê°€ëŠ¥        | ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ì–‘ìª½ ì§€ì› ê°€ëŠ¥       |
| **í´ë¼ì´ì–¸íŠ¸ ì§€ì›**   | ì—†ìŒ                        | ì—†ìŒ                                  | CSRì—ì„œ ë›°ì–´ë‚œ UX / ìžë™ ë°°ê²½ ë™ê¸°í™”   |
| **ìŠ¤íŠ¸ë¦¬ë°/SSR í†µí•©** | Server Components ë‚´ ìžë™ë¨ | ë™ì¼                                  | SSR ì¼ë¶€ ì§€ì›, but ì„¤ì • í•„ìš”           |
| **ì í•©í•œ usecase**    | API ë°ì´í„° ìºì‹±, ISR ì ìš©   | DB ê²°ê³¼, ì„œë²„ ë¡œì§ ìºì‹±               | ì‚¬ìš©ìž ì¸í„°ëž™ì…˜ ì¤‘ì‹¬ ë°ì´í„°, UI ê°±ì‹    |
| **ë‹¨ì  ìš”ì•½**         | client-state ë¡œì§ ë¶€ìž¬      | unstable API & invalidation ì„¤ê³„ í•„ìš” | ì™¸ë¶€ ì˜ì¡´ì„±, ë¹Œë“œ í¬ê¸° ì¦ê°€ ê°€ëŠ¥       |

- **ê¸°ë³¸ ìºì‹œ**: `fetch(..., { cache, next.revalidate })` ë¡œ ê°„íŽ¸í•œ ì„¤ì •
- **ì •ë°€ ìºì‹œ**: `revalidateTag`, `revalidatePath` í™œìš©
- **í•¨ìˆ˜ ìºì‹œ**: `unstable_cache` ë¡œ DB/ë¡œì§ ë°˜ë³µ ë°©ì§€
- **ê³ ê¸‰ UX**: ì‚¬ìš©ìž ì¤‘ì‹¬ ìƒíƒœ/ë¡œë”©/ì—ëŸ¬ ì œì–´ëŠ” React Query / SWR(right layer)

> ### ì¸ìš©
>
> - [í•œ ìž… í¬ê¸°ë¡œ ìž˜ë¼ë¨¹ëŠ” Next.js(v15) ê°•ì˜ | ì´ì •í™˜ Winterlood](https://www.inflearn.com/course/%ED%95%9C%EC%9E%85-%ED%81%AC%EA%B8%B0-nextjs)
> - [Data Fetching, Caching, and Revalidating - Next.js](https://nextjs.org/docs/14/app/building-your-application/data-fetching/fetching-caching-and-revalidating)
> - [How to Cache in React and Next.js Apps with Best Practices for 2025 - Medium](https://medium.com/@jigsz6391/caching-in-react-and-next-js-with-best-practices-for-2025-477729cfe5a4)
> - [NextJS 14 - Cache not revalidating on Vercel servers - Stack Overflow](https://stackoverflow.com/questions/78198681/nextjs-14-cache-not-revalidating-on-vercel-servers)
> - [Functions: unstable_cache - Next.js](https://nextjs.org/docs/app/api-reference/functions/unstable_cache)
